---
import CardIDBadge from '@/components/card/CardIDBadge'
import Headline2 from '@/components/common/Headline2'
import CardDescriptionList from '@/components/pages/card/CardDescriptionList'
import CardMetaTable from '@/components/pages/card/CardMetaTable'
import CardTitle from '@/components/pages/card/CardTitle'
import Layout from '@/layouts/Layout.astro'
import { getSdk } from '@/libs/api/generated'
import { revisionKeys } from '@/libs/domain/Revision'
import { isNonNullable } from '@/libs/utils/types'
import { GraphQLClient } from 'graphql-request'
import { Container } from 'react-bootstrap'

export async function getStaticPaths() {
  const client = new GraphQLClient('https://api.db.agricolajp.dev/graphql')
  const sdk = getSdk(client)
  return (
    await Promise.all(
      revisionKeys.map(async revisionKey => {
        const res = await sdk.GetCardsDetailByRevision({ revisionKey })
        const cards = res.cards?.edges?.map(e => e?.node).filter(isNonNullable) ?? []
        return cards.map(card => ({
          params: {
            revisionKey,
            literalID: card.literalID,
          },
          props: {
            card,
          },
        }))
      }),
    )
  ).flat()
}

const { card } = Astro.props
const { pathname } = Astro.url
---

<Layout title={card.nameJa ?? ''} pathname={pathname}>
  <Container>
    <CardTitle card={card}>
      <CardIDBadge card={card} />
    </CardTitle>
    <CardDescriptionList card={card} />
    <Headline2>メタ情報</Headline2>
    <CardMetaTable card={card} />
  </Container>
</Layout>
